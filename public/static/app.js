// Harmonized Fitness AI Assessment App
// Interactive 4-phase onboarding system

class FitnessAssessment {
  constructor() {\n    this.currentPhase = 1;\n    this.userData = {};\n    this.modal = document.getElementById('assessment-modal');\n    this.content = document.getElementById('assessment-content');\n    \n    this.init();\n  }\n  \n  init() {\n    // Start assessment button\n    document.getElementById('start-assessment')?.addEventListener('click', () => {\n      this.startAssessment();\n    });\n    \n    // Close modal on outside click\n    this.modal?.addEventListener('click', (e) => {\n      if (e.target === this.modal) {\n        this.closeModal();\n      }\n    });\n  }\n  \n  startAssessment() {\n    this.currentPhase = 1;\n    this.userData = {};\n    this.showModal();\n    this.renderPhase1();\n  }\n  \n  showModal() {\n    this.modal.classList.remove('hidden');\n    document.body.style.overflow = 'hidden';\n  }\n  \n  closeModal() {\n    this.modal.classList.add('hidden');\n    document.body.style.overflow = 'auto';\n  }\n  \n  // =======================================================================\n  // PHASE 1: Basic Information Collection\n  // =======================================================================\n  \n  renderPhase1() {\n    this.content.innerHTML = `\n      <div class=\"text-center mb-8\">\n        <div class=\"flex justify-center items-center mb-4\">\n          <div class=\"w-8 h-8 bg-burnt-orange rounded-full flex items-center justify-center text-white font-bold mr-2\">1</div>\n          <div class=\"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold mr-2\">2</div>\n          <div class=\"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold mr-2\">3</div>\n          <div class=\"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold\">4</div>\n        </div>\n        <h2 class=\"text-3xl font-bold text-white mb-2\">Let's Get Started</h2>\n        <p class=\"text-gray-400\">First, tell us a bit about yourself</p>\n      </div>\n      \n      <form id=\"phase1-form\" class=\"space-y-6\">\n        <div>\n          <label class=\"block text-white font-semibold mb-2\" for=\"full_name\">\n            <i class=\"fas fa-user mr-2 text-burnt-orange\"></i>Full Name *\n          </label>\n          <input type=\"text\" id=\"full_name\" name=\"full_name\" required \n                 class=\"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-burnt-orange focus:outline-none transition-colors\">\n        </div>\n        \n        <div>\n          <label class=\"block text-white font-semibold mb-2\" for=\"email\">\n            <i class=\"fas fa-envelope mr-2 text-burnt-orange\"></i>Email Address *\n          </label>\n          <input type=\"email\" id=\"email\" name=\"email\" required \n                 class=\"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-burnt-orange focus:outline-none transition-colors\">\n          <p class=\"text-sm text-gray-400 mt-1\">We'll send your personalized workout plan here</p>\n        </div>\n        \n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <label class=\"block text-white font-semibold mb-2\" for=\"age\">\n              <i class=\"fas fa-calendar mr-2 text-burnt-orange\"></i>Age *\n            </label>\n            <input type=\"number\" id=\"age\" name=\"age\" min=\"18\" max=\"80\" required \n                   class=\"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-burnt-orange focus:outline-none transition-colors\">\n          </div>\n          \n          <div>\n            <label class=\"block text-white font-semibold mb-2\" for=\"gender\">\n              <i class=\"fas fa-venus-mars mr-2 text-burnt-orange\"></i>Gender *\n            </label>\n            <select id=\"gender\" name=\"gender\" required \n                    class=\"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-burnt-orange focus:outline-none transition-colors\">\n              <option value=\"\">Select Gender</option>\n              <option value=\"male\">Male</option>\n              <option value=\"female\">Female</option>\n              <option value=\"non_binary\">Non-binary</option>\n              <option value=\"prefer_not_to_say\">Prefer not to say</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"flex justify-between pt-6\">\n          <button type=\"button\" onclick=\"assessment.closeModal()\" \n                  class=\"px-6 py-3 text-gray-400 hover:text-white transition-colors\">\n            <i class=\"fas fa-times mr-2\"></i>Cancel\n          </button>\n          <button type=\"submit\" \n                  class=\"bg-burnt-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105\">\n            Continue <i class=\"fas fa-arrow-right ml-2\"></i>\n          </button>\n        </div>\n      </form>\n    `;\n    \n    // Handle form submission\n    document.getElementById('phase1-form').addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handlePhase1Submit(e.target);\n    });\n  }\n  \n  async handlePhase1Submit(form) {\n    const formData = new FormData(form);\n    const data = Object.fromEntries(formData.entries());\n    \n    // Basic validation\n    if (!data.full_name || !data.email || !data.age || !data.gender) {\n      this.showError('Please fill in all required fields');\n      return;\n    }\n    \n    try {\n      const response = await axios.post('/api/users', {\n        full_name: data.full_name,\n        email: data.email,\n        age: parseInt(data.age),\n        gender: data.gender\n      });\n      \n      if (response.data.success) {\n        this.userData = { ...data, user_id: response.data.user_id };\n        this.currentPhase = 2;\n        this.renderPhase2();\n      } else {\n        this.showError(response.data.error || 'Failed to save your information');\n      }\n    } catch (error) {\n      console.error('Phase 1 error:', error);\n      this.showError('Something went wrong. Please try again.');\n    }\n  }\n  \n  // =======================================================================\n  // PHASE 2: Fitness Assessment\n  // =======================================================================\n  \n  renderPhase2() {\n    this.content.innerHTML = `\n      <div class=\"text-center mb-8\">\n        <div class=\"flex justify-center items-center mb-4\">\n          <div class=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-2\">âœ“</div>\n          <div class=\"w-8 h-8 bg-burnt-orange rounded-full flex items-center justify-center text-white font-bold mr-2\">2</div>\n          <div class=\"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold mr-2\">3</div>\n          <div class=\"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold\">4</div>\n        </div>\n        <h2 class=\"text-3xl font-bold text-white mb-2\">Fitness Assessment</h2>\n        <p class=\"text-gray-400\">Help us understand your current fitness level and goals</p>\n      </div>\n      \n      <form id=\"phase2-form\" class=\"space-y-8\">\n        <div>\n          <label class=\"block text-white font-semibold mb-4\">\n            <i class=\"fas fa-trophy mr-2 text-burnt-orange\"></i>What's your experience level?\n          </label>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"experience_level\" value=\"beginner\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\">Beginner</div>\n                <div class=\"text-sm text-gray-400\">New to fitness or returning after a break</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"experience_level\" value=\"intermediate\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\">Intermediate</div>\n                <div class=\"text-sm text-gray-400\">Regular exercise for 6+ months</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"experience_level\" value=\"advanced\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\">Advanced</div>\n                <div class=\"text-sm text-gray-400\">Consistent training for 2+ years</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"experience_level\" value=\"expert\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\">Expert</div>\n                <div class=\"text-sm text-gray-400\">Athlete or fitness professional level</div>\n              </div>\n            </label>\n          </div>\n        </div>\n        \n        <div>\n          <label class=\"block text-white font-semibold mb-4\">\n            <i class=\"fas fa-clock mr-2 text-burnt-orange\"></i>How much time can you dedicate per workout?\n          </label>\n          <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"workout_duration\" value=\"15-30\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option text-center\">\n                <div class=\"font-bold text-white\">15-30 min</div>\n                <div class=\"text-sm text-gray-400\">Quick & efficient</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"workout_duration\" value=\"30-45\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option text-center\">\n                <div class=\"font-bold text-white\">30-45 min</div>\n                <div class=\"text-sm text-gray-400\">Balanced</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"workout_duration\" value=\"45-60\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option text-center\">\n                <div class=\"font-bold text-white\">45-60 min</div>\n                <div class=\"text-sm text-gray-400\">Comprehensive</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"workout_duration\" value=\"60+\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option text-center\">\n                <div class=\"font-bold text-white\">60+ min</div>\n                <div class=\"text-sm text-gray-400\">Extended</div>\n              </div>\n            </label>\n          </div>\n        </div>\n        \n        <div>\n          <label class=\"block text-white font-semibold mb-4\">\n            <i class=\"fas fa-bullseye mr-2 text-burnt-orange\"></i>What's your primary fitness goal?\n          </label>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"primary_goal\" value=\"weight_loss\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\"><i class=\"fas fa-fire mr-2\"></i>Weight Loss & Fat Burning</div>\n                <div class=\"text-sm text-gray-400\">Burn calories and lean out</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"primary_goal\" value=\"muscle_building\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\"><i class=\"fas fa-dumbbell mr-2\"></i>Muscle Building</div>\n                <div class=\"text-sm text-gray-400\">Build lean muscle mass</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"primary_goal\" value=\"strength_power\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\"><i class=\"fas fa-bolt mr-2\"></i>Strength & Power</div>\n                <div class=\"text-sm text-gray-400\">Increase functional strength</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"primary_goal\" value=\"military_tactical\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\"><i class=\"fas fa-medal mr-2\"></i>Military/Tactical Prep</div>\n                <div class=\"text-sm text-gray-400\">Combat-ready conditioning</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"primary_goal\" value=\"glute_enhancement\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\"><i class=\"fas fa-heart mr-2\"></i>Glute Enhancement</div>\n                <div class=\"text-sm text-gray-400\">Lower body focus and shaping</div>\n              </div>\n            </label>\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"primary_goal\" value=\"next_level_performance\" class=\"sr-only\">\n              <div class=\"p-4 border-2 border-gray-600 rounded-lg hover:border-burnt-orange transition-colors radio-option\">\n                <div class=\"font-bold text-white mb-1\"><i class=\"fas fa-rocket mr-2\"></i>Next Level Performance</div>\n                <div class=\"text-sm text-gray-400\">Elite athletic development</div>\n              </div>\n            </label>\n          </div>\n        </div>\n        \n        <div class=\"flex justify-between pt-6\">\n          <button type=\"button\" onclick=\"assessment.renderPhase1()\" \n                  class=\"px-6 py-3 text-gray-400 hover:text-white transition-colors\">\n            <i class=\"fas fa-arrow-left mr-2\"></i>Back\n          </button>\n          <button type=\"submit\" \n                  class=\"bg-burnt-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105\">\n            Continue <i class=\"fas fa-arrow-right ml-2\"></i>\n          </button>\n        </div>\n      </form>\n    `;\n    \n    this.setupRadioButtons();\n    \n    // Handle form submission\n    document.getElementById('phase2-form').addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handlePhase2Submit(e.target);\n    });\n  }\n  \n  async handlePhase2Submit(form) {\n    const formData = new FormData(form);\n    const data = Object.fromEntries(formData.entries());\n    \n    if (!data.experience_level || !data.workout_duration || !data.primary_goal) {\n      this.showError('Please select all options to continue');\n      return;\n    }\n    \n    // Add workout environment based on primary goal (simplified logic)\n    data.workout_environment = {\n      'weight_loss': 'time_constrained',\n      'muscle_building': 'gym_access',\n      'strength_power': 'gym_access',\n      'military_tactical': 'equipment_limited',\n      'glute_enhancement': 'home_focused',\n      'next_level_performance': 'gym_access'\n    }[data.primary_goal] || 'home_focused';\n    \n    try {\n      const response = await axios.post(`/api/users/${this.userData.user_id}/fitness-profile`, data);\n      \n      if (response.data.success) {\n        this.userData = { ...this.userData, ...data };\n        this.currentPhase = 3;\n        this.renderPhase3();\n      } else {\n        this.showError(response.data.error || 'Failed to save your fitness assessment');\n      }\n    } catch (error) {\n      console.error('Phase 2 error:', error);\n      this.showError('Something went wrong. Please try again.');\n    }\n  }\n  \n  // =======================================================================\n  // PHASE 3: Equipment Assessment\n  // =======================================================================\n  \n  renderPhase3() {\n    this.content.innerHTML = `\n      <div class=\"text-center mb-8\">\n        <div class=\"flex justify-center items-center mb-4\">\n          <div class=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-2\">âœ“</div>\n          <div class=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-2\">âœ“</div>\n          <div class=\"w-8 h-8 bg-burnt-orange rounded-full flex items-center justify-center text-white font-bold mr-2\">3</div>\n          <div class=\"w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold\">4</div>\n        </div>\n        <h2 class=\"text-3xl font-bold text-white mb-2\">Equipment Check</h2>\n        <p class=\"text-gray-400\">What equipment do you have access to? (Select all that apply)</p>\n      </div>\n      \n      <form id=\"phase3-form\" class=\"space-y-6\">\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"bodyweight\" class=\"sr-only\" checked>\n            <div class=\"p-4 border-2 border-burnt-orange rounded-lg checkbox-option selected\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-running text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Bodyweight Only</div>\n                  <div class=\"text-sm text-gray-400\">No equipment needed</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"resistance_bands\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-grip-lines text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Resistance Bands</div>\n                  <div class=\"text-sm text-gray-400\">Bands, TRX, suspension trainers</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"dumbbells\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-dumbbell text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Dumbbells</div>\n                  <div class=\"text-sm text-gray-400\">Dumbbells, adjustable weights</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"kettlebells\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-weight-hanging text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Kettlebells</div>\n                  <div class=\"text-sm text-gray-400\">Various weights available</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"barbells\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-barbell text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Barbells & Plates</div>\n                  <div class=\"text-sm text-gray-400\">Olympic bar, weight plates</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"pullup_bar\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-grip-horizontal text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Pull-up Bar</div>\n                  <div class=\"text-sm text-gray-400\">Door frame or mounted bar</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"cardio_machines\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-heartbeat text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Cardio Machines</div>\n                  <div class=\"text-sm text-gray-400\">Treadmill, bike, elliptical</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n          \n          <label class=\"cursor-pointer\">\n            <input type=\"checkbox\" name=\"equipment\" value=\"gym_membership\" class=\"sr-only\">\n            <div class=\"p-4 border-2 border-gray-600 rounded-lg checkbox-option hover:border-burnt-orange transition-colors\">\n              <div class=\"flex items-center\">\n                <i class=\"fas fa-building text-burnt-orange mr-3\"></i>\n                <div>\n                  <div class=\"font-bold text-white\">Full Gym Access</div>\n                  <div class=\"text-sm text-gray-400\">Commercial gym membership</div>\n                </div>\n                <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n              </div>\n            </div>\n          </label>\n        </div>\n        \n        <div class=\"flex justify-between pt-6\">\n          <button type=\"button\" onclick=\"assessment.renderPhase2()\" \n                  class=\"px-6 py-3 text-gray-400 hover:text-white transition-colors\">\n            <i class=\"fas fa-arrow-left mr-2\"></i>Back\n          </button>\n          <button type=\"submit\" \n                  class=\"bg-burnt-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105\">\n            Continue <i class=\"fas fa-arrow-right ml-2\"></i>\n          </button>\n        </div>\n      </form>\n    `;\n    \n    this.setupCheckboxes();\n    \n    // Handle form submission\n    document.getElementById('phase3-form').addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handlePhase3Submit(e.target);\n    });\n  }\n  \n  async handlePhase3Submit(form) {\n    const formData = new FormData(form);\n    const equipment = formData.getAll('equipment');\n    \n    if (equipment.length === 0) {\n      this.showError('Please select at least one equipment option');\n      return;\n    }\n    \n    try {\n      const response = await axios.post(`/api/users/${this.userData.user_id}/equipment`, {\n        equipment: equipment\n      });\n      \n      if (response.data.success) {\n        this.userData.equipment = equipment;\n        this.currentPhase = 4;\n        this.renderPhase4();\n      } else {\n        this.showError(response.data.error || 'Failed to save your equipment profile');\n      }\n    } catch (error) {\n      console.error('Phase 3 error:', error);\n      this.showError('Something went wrong. Please try again.');\n    }\n  }\n  \n  // =======================================================================\n  // PHASE 4: Injury Screening\n  // =======================================================================\n  \n  renderPhase4() {\n    this.content.innerHTML = `\n      <div class=\"text-center mb-8\">\n        <div class=\"flex justify-center items-center mb-4\">\n          <div class=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-2\">âœ“</div>\n          <div class=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-2\">âœ“</div>\n          <div class=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold mr-2\">âœ“</div>\n          <div class=\"w-8 h-8 bg-burnt-orange rounded-full flex items-center justify-center text-white font-bold\">4</div>\n        </div>\n        <h2 class=\"text-3xl font-bold text-white mb-2\">Safety First</h2>\n        <p class=\"text-gray-400\">Any current injuries or limitations we should know about?</p>\n      </div>\n      \n      <form id=\"phase4-form\" class=\"space-y-8\">\n        <div class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"has_injuries\" value=\"no\" class=\"sr-only\" checked>\n              <div class=\"p-6 border-2 border-burnt-orange rounded-lg radio-option selected\">\n                <i class=\"fas fa-check-circle text-4xl text-green-500 mb-3\"></i>\n                <div class=\"font-bold text-white text-lg\">No Current Issues</div>\n                <div class=\"text-sm text-gray-400 mt-2\">I'm ready to start training safely</div>\n              </div>\n            </label>\n            \n            <label class=\"cursor-pointer\">\n              <input type=\"radio\" name=\"has_injuries\" value=\"yes\" class=\"sr-only\">\n              <div class=\"p-6 border-2 border-gray-600 rounded-lg radio-option hover:border-burnt-orange transition-colors\">\n                <i class=\"fas fa-exclamation-triangle text-4xl text-yellow-500 mb-3\"></i>\n                <div class=\"font-bold text-white text-lg\">Yes, I have limitations</div>\n                <div class=\"text-sm text-gray-400 mt-2\">I need exercise modifications</div>\n              </div>\n            </label>\n          </div>\n        </div>\n        \n        <div id=\"injury-details\" class=\"hidden\">\n          <div class=\"bg-gray-800 p-6 rounded-lg\">\n            <h3 class=\"text-white font-bold mb-4\">Please select any that apply:</h3>\n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              <label class=\"cursor-pointer\">\n                <input type=\"checkbox\" name=\"injuries\" value=\"lower_back\" class=\"sr-only\">\n                <div class=\"p-3 border border-gray-600 rounded checkbox-option hover:border-burnt-orange transition-colors\">\n                  <span class=\"text-white\">Lower Back Pain/Injury</span>\n                  <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n                </div>\n              </label>\n              <label class=\"cursor-pointer\">\n                <input type=\"checkbox\" name=\"injuries\" value=\"knee\" class=\"sr-only\">\n                <div class=\"p-3 border border-gray-600 rounded checkbox-option hover:border-burnt-orange transition-colors\">\n                  <span class=\"text-white\">Knee Issues</span>\n                  <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n                </div>\n              </label>\n              <label class=\"cursor-pointer\">\n                <input type=\"checkbox\" name=\"injuries\" value=\"shoulder\" class=\"sr-only\">\n                <div class=\"p-3 border border-gray-600 rounded checkbox-option hover:border-burnt-orange transition-colors\">\n                  <span class=\"text-white\">Shoulder Problems</span>\n                  <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n                </div>\n              </label>\n              <label class=\"cursor-pointer\">\n                <input type=\"checkbox\" name=\"injuries\" value=\"wrist\" class=\"sr-only\">\n                <div class=\"p-3 border border-gray-600 rounded checkbox-option hover:border-burnt-orange transition-colors\">\n                  <span class=\"text-white\">Wrist/Hand Issues</span>\n                  <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n                </div>\n              </label>\n              <label class=\"cursor-pointer\">\n                <input type=\"checkbox\" name=\"injuries\" value=\"ankle\" class=\"sr-only\">\n                <div class=\"p-3 border border-gray-600 rounded checkbox-option hover:border-burnt-orange transition-colors\">\n                  <span class=\"text-white\">Ankle/Foot Problems</span>\n                  <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n                </div>\n              </label>\n              <label class=\"cursor-pointer\">\n                <input type=\"checkbox\" name=\"injuries\" value=\"neck\" class=\"sr-only\">\n                <div class=\"p-3 border border-gray-600 rounded checkbox-option hover:border-burnt-orange transition-colors\">\n                  <span class=\"text-white\">Neck Issues</span>\n                  <i class=\"fas fa-check ml-auto text-burnt-orange check-icon hidden\"></i>\n                </div>\n              </label>\n            </div>\n            <div class=\"mt-4\">\n              <label class=\"block text-white font-semibold mb-2\">Additional Notes (Optional):</label>\n              <textarea name=\"injury_notes\" rows=\"3\" \n                        class=\"w-full p-3 bg-gray-700 border border-gray-600 rounded text-white focus:border-burnt-orange focus:outline-none\"\n                        placeholder=\"Any specific details about your limitations or concerns...\"></textarea>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"flex justify-between pt-6\">\n          <button type=\"button\" onclick=\"assessment.renderPhase3()\" \n                  class=\"px-6 py-3 text-gray-400 hover:text-white transition-colors\">\n            <i class=\"fas fa-arrow-left mr-2\"></i>Back\n          </button>\n          <button type=\"submit\" \n                  class=\"bg-burnt-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105\">\n            Generate My Workout! <i class=\"fas fa-magic ml-2\"></i>\n          </button>\n        </div>\n      </form>\n    `;\n    \n    this.setupRadioButtons();\n    this.setupCheckboxes();\n    \n    // Show/hide injury details based on selection\n    document.querySelectorAll('input[name=\"has_injuries\"]').forEach(radio => {\n      radio.addEventListener('change', () => {\n        const injuryDetails = document.getElementById('injury-details');\n        if (radio.value === 'yes' && radio.checked) {\n          injuryDetails.classList.remove('hidden');\n        } else {\n          injuryDetails.classList.add('hidden');\n        }\n      });\n    });\n    \n    // Handle form submission\n    document.getElementById('phase4-form').addEventListener('submit', (e) => {\n      e.preventDefault();\n      this.handlePhase4Submit(e.target);\n    });\n  }\n  \n  async handlePhase4Submit(form) {\n    const formData = new FormData(form);\n    const hasInjuries = formData.get('has_injuries');\n    \n    let injuries = [];\n    if (hasInjuries === 'yes') {\n      const selectedInjuries = formData.getAll('injuries');\n      const notes = formData.get('injury_notes') || '';\n      \n      injuries = selectedInjuries.map(injury => ({\n        type: injury,\n        body_part: injury,\n        severity: 'moderate',\n        is_current: true,\n        notes: notes\n      }));\n    }\n    \n    try {\n      // Save injury profile\n      const injuryResponse = await axios.post(`/api/users/${this.userData.user_id}/injuries`, {\n        injuries: injuries\n      });\n      \n      if (injuryResponse.data.success) {\n        // Generate workout\n        this.generateWorkout();\n      } else {\n        this.showError(injuryResponse.data.error || 'Failed to save your safety profile');\n      }\n    } catch (error) {\n      console.error('Phase 4 error:', error);\n      this.showError('Something went wrong. Please try again.');\n    }\n  }\n  \n  // =======================================================================\n  // WORKOUT GENERATION & RESULTS\n  // =======================================================================\n  \n  async generateWorkout() {\n    // Show loading state\n    this.content.innerHTML = `\n      <div class=\"text-center py-16\">\n        <div class=\"mb-8\">\n          <i class=\"fas fa-cog fa-spin text-6xl text-burnt-orange mb-4\"></i>\n          <h2 class=\"text-3xl font-bold text-white mb-4\">Generating Your Personalized Workout</h2>\n          <p class=\"text-gray-400 text-lg\">Our AI is analyzing your profile and creating the perfect fitness plan...</p>\n        </div>\n        <div class=\"max-w-md mx-auto\">\n          <div class=\"bg-gray-800 rounded-full h-2 mb-4\">\n            <div class=\"bg-burnt-orange h-2 rounded-full animate-pulse\" style=\"width: 85%\"></div>\n          </div>\n          <p class=\"text-sm text-gray-500\">Matching exercises to your goals and equipment...</p>\n        </div>\n      </div>\n    `;\n    \n    try {\n      const response = await axios.post(`/api/users/${this.userData.user_id}/generate-workout`);\n      \n      if (response.data.success) {\n        this.showWorkoutResults(response.data.workout);\n      } else {\n        this.showError(response.data.error || 'Failed to generate your workout');\n      }\n    } catch (error) {\n      console.error('Workout generation error:', error);\n      this.showError('Failed to generate your workout. Please try again.');\n    }\n  }\n  \n  showWorkoutResults(workout) {\n    this.content.innerHTML = `\n      <div class=\"text-center mb-8\">\n        <div class=\"mb-6\">\n          <i class=\"fas fa-trophy text-6xl text-burnt-orange mb-4\"></i>\n          <h2 class=\"text-4xl font-bold text-white mb-4\">Your Personalized Workout is Ready!</h2>\n          <p class=\"text-gray-400 text-lg\">Based on your profile, here's your custom fitness plan</p>\n        </div>\n      </div>\n      \n      <div class=\"bg-gradient-to-r from-burnt-orange/20 to-orange-900/20 rounded-lg p-6 mb-8\">\n        <h3 class=\"text-2xl font-bold text-white mb-4\">${workout.name}</h3>\n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-6 text-center\">\n          <div>\n            <i class=\"fas fa-clock text-2xl text-burnt-orange mb-2\"></i>\n            <div class=\"text-white font-bold\">${workout.estimated_duration} minutes</div>\n            <div class=\"text-gray-400 text-sm\">Duration</div>\n          </div>\n          <div>\n            <i class=\"fas fa-fire text-2xl text-burnt-orange mb-2\"></i>\n            <div class=\"text-white font-bold\">~${workout.estimated_calories} calories</div>\n            <div class=\"text-gray-400 text-sm\">Estimated burn</div>\n          </div>\n          <div>\n            <i class=\"fas fa-star text-2xl text-burnt-orange mb-2\"></i>\n            <div class=\"text-white font-bold\">${'â˜…'.repeat(workout.difficulty_score)}${'â˜†'.repeat(5-workout.difficulty_score)}</div>\n            <div class=\"text-gray-400 text-sm\">Difficulty</div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"space-y-6 mb-8\">\n        <div>\n          <h4 class=\"text-xl font-bold text-white mb-3\"><i class=\"fas fa-play text-burnt-orange mr-2\"></i>Warm-up (5 minutes)</h4>\n          <div class=\"bg-gray-800 rounded-lg p-4\">\n            <ul class=\"text-gray-300 space-y-1\">\n              ${workout.structure.warmup.map(exercise => `<li>â€¢ ${exercise}</li>`).join('')}\n            </ul>\n          </div>\n        </div>\n        \n        <div>\n          <h4 class=\"text-xl font-bold text-white mb-3\"><i class=\"fas fa-dumbbell text-burnt-orange mr-2\"></i>Main Workout</h4>\n          <div class=\"space-y-3\">\n            ${workout.exercises.slice(0, 4).map((exercise, index) => `\n              <div class=\"bg-gray-800 rounded-lg p-4\">\n                <div class=\"flex justify-between items-start\">\n                  <div class=\"flex-1\">\n                    <h5 class=\"font-bold text-white mb-2\">${index + 1}. ${exercise.name}</h5>\n                    <p class=\"text-gray-400 text-sm mb-2\">${exercise.instructions.substring(0, 100)}...</p>\n                    <div class=\"flex items-center text-sm text-gray-500\">\n                      <span class=\"mr-4\"><i class=\"fas fa-target mr-1\"></i>${exercise.primary_muscle_group}</span>\n                      <span class=\"mr-4\"><i class=\"fas fa-star mr-1\"></i>Level ${exercise.difficulty_level}</span>\n                      <span><i class=\"fas fa-fire mr-1\"></i>~${exercise.estimated_calories_per_minute} cal/min</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n        \n        <div>\n          <h4 class=\"text-xl font-bold text-white mb-3\"><i class=\"fas fa-heart text-burnt-orange mr-2\"></i>Cool-down (5 minutes)</h4>\n          <div class=\"bg-gray-800 rounded-lg p-4\">\n            <ul class=\"text-gray-300 space-y-1\">\n              ${workout.structure.cooldown.map(exercise => `<li>â€¢ ${exercise}</li>`).join('')}\n            </ul>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"bg-gradient-to-r from-green-900/50 to-emerald-900/50 rounded-lg p-6 mb-8\">\n        <h4 class=\"text-xl font-bold text-white mb-3\"><i class=\"fas fa-gift text-green-400 mr-2\"></i>Your FREE 14-Day Program Includes:</h4>\n        <ul class=\"text-gray-300 space-y-2\">\n          <li><i class=\"fas fa-check text-green-400 mr-2\"></i>14 progressive workout plans</li>\n          <li><i class=\"fas fa-check text-green-400 mr-2\"></i>Detailed exercise instructions & videos</li>\n          <li><i class=\"fas fa-check text-green-400 mr-2\"></i>Nutrition guidance from military nutrition experts</li>\n          <li><i class=\"fas fa-check text-green-400 mr-2\"></i>Progress tracking tools</li>\n          <li><i class=\"fas fa-check text-green-400 mr-2\"></i>Direct access to Kyle (Kai) for questions</li>\n        </ul>\n      </div>\n      \n      <div class=\"text-center\">\n        <button id=\"claim-program\" \n                class=\"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-8 rounded-lg text-lg transition-all duration-300 transform hover:scale-105 shadow-lg mb-4\">\n          <i class=\"fas fa-download mr-3\"></i>\n          Claim Your FREE 14-Day Program\n        </button>\n        <p class=\"text-gray-400 text-sm\">Program will be sent to ${this.userData.email}</p>\n        \n        <div class=\"mt-8 pt-8 border-t border-gray-700\">\n          <button onclick=\"assessment.closeModal()\" \n                  class=\"text-gray-400 hover:text-white transition-colors\">\n            <i class=\"fas fa-times mr-2\"></i>Close\n          </button>\n        </div>\n      </div>\n    `;\n    \n    // Handle program claim\n    document.getElementById('claim-program').addEventListener('click', () => {\n      this.claimProgram();\n    });\n  }\n  \n  claimProgram() {\n    // Track conversion event\n    axios.post(`/api/users/${this.userData.user_id}/claim-program`).catch(console.error);\n    \n    // Show success message\n    this.content.innerHTML = `\n      <div class=\"text-center py-16\">\n        <i class=\"fas fa-check-circle text-8xl text-green-500 mb-6\"></i>\n        <h2 class=\"text-4xl font-bold text-white mb-4\">Welcome to Harmonized Fitness!</h2>\n        <p class=\"text-xl text-gray-300 mb-8\">Your FREE 14-day program is on its way to <strong>${this.userData.email}</strong></p>\n        \n        <div class=\"bg-gradient-to-r from-burnt-orange/20 to-orange-900/20 rounded-lg p-6 mb-8 max-w-2xl mx-auto\">\n          <h3 class=\"text-xl font-bold text-white mb-4\">What happens next?</h3>\n          <ul class=\"text-gray-300 space-y-3 text-left\">\n            <li><i class=\"fas fa-envelope text-burnt-orange mr-3\"></i>Check your email for your complete program (arriving in 2-3 minutes)</li>\n            <li><i class=\"fas fa-calendar text-burnt-orange mr-3\"></i>Start Day 1 tomorrow morning for best results</li>\n            <li><i class=\"fas fa-phone text-burnt-orange mr-3\"></i>Kyle will personally check in with you after Day 3</li>\n            <li><i class=\"fas fa-star text-burnt-orange mr-3\"></i>Bonus: Access to our private military fitness community</li>\n          </ul>\n        </div>\n        \n        <div class=\"space-y-4\">\n          <button onclick=\"window.open('https://harmonizedfitness.com', '_blank')\" \n                  class=\"bg-burnt-orange hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 mr-4\">\n            <i class=\"fas fa-external-link-alt mr-2\"></i>Visit HarmonizedFitness.com\n          </button>\n          <button onclick=\"assessment.closeModal()\" \n                  class=\"border border-gray-600 hover:border-white text-gray-400 hover:text-white font-bold py-3 px-8 rounded-lg transition-all duration-300\">\n            <i class=\"fas fa-times mr-2\"></i>Close\n          </button>\n        </div>\n      </div>\n    `;\n  }\n  \n  // =======================================================================\n  // UI HELPER FUNCTIONS\n  // =======================================================================\n  \n  setupRadioButtons() {\n    document.querySelectorAll('input[type=\"radio\"]').forEach(radio => {\n      radio.addEventListener('change', () => {\n        // Remove selected class from all options with same name\n        document.querySelectorAll(`input[name=\"${radio.name}\"]`).forEach(r => {\n          r.closest('label').querySelector('.radio-option').classList.remove('selected', 'border-burnt-orange');\n          r.closest('label').querySelector('.radio-option').classList.add('border-gray-600');\n        });\n        \n        // Add selected class to chosen option\n        if (radio.checked) {\n          radio.closest('label').querySelector('.radio-option').classList.add('selected', 'border-burnt-orange');\n          radio.closest('label').querySelector('.radio-option').classList.remove('border-gray-600');\n        }\n      });\n    });\n  }\n  \n  setupCheckboxes() {\n    document.querySelectorAll('input[type=\"checkbox\"]').forEach(checkbox => {\n      checkbox.addEventListener('change', () => {\n        const option = checkbox.closest('label').querySelector('.checkbox-option');\n        const checkIcon = checkbox.closest('label').querySelector('.check-icon');\n        \n        if (checkbox.checked) {\n          option.classList.add('selected', 'border-burnt-orange');\n          option.classList.remove('border-gray-600');\n          checkIcon.classList.remove('hidden');\n        } else {\n          option.classList.remove('selected', 'border-burnt-orange');\n          option.classList.add('border-gray-600');\n          checkIcon.classList.add('hidden');\n        }\n      });\n    });\n  }\n  \n  showError(message) {\n    // Simple error display - could be enhanced with better styling\n    const errorDiv = document.createElement('div');\n    errorDiv.className = 'bg-red-600 text-white p-4 rounded-lg mb-4';\n    errorDiv.innerHTML = `<i class=\"fas fa-exclamation-triangle mr-2\"></i>${message}`;\n    \n    this.content.insertBefore(errorDiv, this.content.firstChild);\n    \n    // Remove error after 5 seconds\n    setTimeout(() => {\n      errorDiv.remove();\n    }, 5000);\n  }\n}\n\n// Initialize the assessment when DOM is ready\nlet assessment;\ndocument.addEventListener('DOMContentLoaded', () => {\n  assessment = new FitnessAssessment();\n});